## 基础配置

> [ 思维导图全览-点我](https://www.processon.com/mindmap/5cbfd37ce4b059e20a05b6a9)

### 开发环境（推荐）
工具的统一，是为了方便工作流的统一，还有工具使用经验的传承。

团队里的成员，经常需要互相使用对方电脑来讨论问题、查看某段代码、Debug 某个功能，工具统一起来后，你会发现，虽然是别人的电脑，工具使用起来是熟悉的，用起来就跟自己的电脑一样顺手，自然的工作效率就会提高。

* 硬件：Retina MacBook Pro 15 寸
* 系统：Mac 版本 10.10 以上
* 编辑器：[VS Code](<https://code.visualstudio.com/>)
* 编辑器代码格式化：ESLint、StandarJS
* 代码质量校验器：SonarLint
* 命令行工具：[iTerm2](https://www.iterm2.com/)
* 浏览器：[Chrome](https://www.google.com/chrome/browser/desktop/index.html)
* 虚拟机：[VirtualBox](https://www.virtualbox.org/)
* MySQL 数据库查询工具：[Sequel Pro](http://www.sequelpro.com/) Or Navicat
* Redis 管理工具：[RDM](http://redisdesktop.com/)
* MongoDB 管理工具：[MongoDB](https://robomongo.org/)
* 设计工具：[Sketch 3](https://www.sketchapp.com/)
* 视频播放：[MPlayerX](http://mplayerx.org/)
* @todo zsh 的配置信息统一，Alias 等信息。

![RMBP](https://dev-vr-static.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E7%89%8733.png)

### 开发插件(效率辅助)
| 名称                                                         |                        |
| ------------------------------------------------------------ | ---------------------- |
| [Ant Design Snippets](<https://marketplace.visualstudio.com/itemdetails?itemName=bang.antd-snippets>) | Ant Design开发必备     |
| [Color Highlight](<https://marketplace.visualstudio.com/itemdetails?itemName=naumovs.color-highlight>) | 高亮显示web颜色        |
| [Document This](<https://marketplace.visualstudio.com/itemdetails?itemName=joelday.docthis>) | 自动生成注释格式       |
| [ES7 React/Redux/GraphQL/React-Native snippets](<https://marketplace.visualstudio.com/itemdetails?itemName=dsznajder.es7-react-js-snippets>) | React最新的ES7语法必备 |
| [ESLint](<https://marketplace.visualstudio.com/itemdetails?itemName=dbaeumer.vscode-eslint>) | 前端代码检验必备       |
| [GitLens](<https://marketplace.visualstudio.com/itemdetails?itemName=eamodio.gitlens>) | git管理工具            |
| [JavaScript (ES6) code snippets](https://marketplace.visualstudio.com/itemdetails?itemName=eamodio.gitlens) | ES6语法必备            |
| [Live Server](<https://marketplace.visualstudio.com/itemdetails?itemName=ritwickdey.LiveServer>) | 静态文件服务           |
| [Material Icon Theme](<https://marketplace.visualstudio.com/itemdetails?itemName=PKief.material-icon-theme>) | 非常好看的文件icon     |
| [Material Theme](https://marketplace.visualstudio.com/itemdetails?itemName=Equinusocio.vsc-material-theme) | 非常好看的主题         |
| [SonarLint](https://marketplace.visualstudio.com/itemdetails?itemName=SonarSource.sonarlint-vscode) | 代码质量检测，必备     |
| [TODO Highlight](https://marketplace.visualstudio.com/itemdetails?itemName=wayou.vscode-todo-highlight) | 效率工具，高亮todo任务 |
| [Vetur](<https://marketplace.visualstudio.com/itemdetails?itemName=octref.vetur>) | Vue开发必备            |
| [Vue 2 Snippets](<https://marketplace.visualstudio.com/itemdetails?itemName=hollowtree.vue-snippets>) | Vue语法提示            |
| [Vue](<https://marketplace.visualstudio.com/itemdetails?itemName=jcbuisson.vue>) | Vue文件解析            |
| [StandardJS - JavaScript Standard Style](<https://marketplace.visualstudio.com/itemdetails?itemName=chenxsan.vscode-standardjs>) | Nodejs后端开发必备     |
| [Prettier](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) | 格式化必备             |
| [Git History](https://marketplace.visualstudio.com/items?itemName=donjayamanne.githistory) | git可视化提交记录      |



## 代码风格(必须)
我们对代码格式做了统一风格配置，减少重复配置差异问题。分为以下几块
```bash
├── css/less/sass
│   ├── stylelint-config-standard
│   ├── stylelint-config-css-modules
│   ├── stylelint-config-rational-order
│   └── stylelint-config-prettier
├── js
│   ├── eslint-config-airbnb
│   └── eslint-config-prettier
├── ts
│   ├── tslint-react
│   └── tslint-config-prettier
├── jsx
│   ├── eslint-plugin-react
│   ├── eslint-plugin-jsx-a11y
│   └── plugin:compat/recommended
└── vue
    ├── eslint-plugin-vue
    ├── plugin:vue/recommended
    └── eslint:recommended
```



## 代码质量(必须)

### husky

git hook 代码commit时
自动化检测代码是否编写规范
不规范代码不允许提交

### sonarlint

非强制，可以检查代码安全风险
红色标记必须修复
黄色警告请警惕并优化代码

### eslint

强制，代码书写规范
红色标记必须修复
黄色警告请警惕并优化代码

### stylelint

强制，代码书写规范
红色标记必须修复
黄色警告请警惕并优化代码

### sonarqube

每次提交代码
自动将代码扫描至公司内建sonarqube平台
项目技术负债必须小于一天

## 协作流程(必须)

- 以git作为代码管理工具

- 源码和构建后的项目分开

- 本地开发以develop为主干, 新建分支开发功能，提交pull request

- 功能开发完成
  开发打包项目develop验证
  产品在test验证
  转测试在test验证
  发布线上master再此验证

  

### 分支管理

- 项目源码分支
  按照github官方推荐协作方式

- 项目打包分支
  脚本自动构建


## 部署(必须)
- 前端代码使用自动构建脚本+ CI
  实现自动部署

- shell_build https://git.jiatuiyun.net/vernzhang/shell_build

## 组件(必须)

现阶段我们使用蚂蚁金服团队研发的 Ant Design 提供的全套解决方案



## 错误码(必须)

遵照维基百科

> https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#2xx_Success

```javascript
const codeMessage = {
  200: '服务器成功返回请求的数据。',
  201: '新建或修改数据成功。',
  202: '一个请求已经进入后台排队（异步任务）。',
  204: '删除数据成功。',
  400: '发出的请求有错误，服务器没有进行新建或修改数据的操作。',
  401: '用户没有权限（令牌、用户名、密码错误）。',
  403: '用户得到授权，但是访问是被禁止的。',
  404: '发出的请求针对的是不存在的记录，服务器没有进行操作。',
  406: '请求的格式不可得。',
  410: '请求的资源被永久删除，且不会再得到的。',
  422: '当创建一个对象时，发生一个验证错误。',
  500: '服务器发生错误，请检查服务器。',
  502: '网关错误。',
  503: '服务不可用，服务器暂时过载或维护。',
  504: '网关超时。',
};
```



## 请求(必须)

### requset

- REST Ful API
- 普通API

维基百科参考

>  https://en.wikipedia.org/wiki/Representational_state_transfer

### response

- 普通数据
```json
{
  data: {},
  msg: "",
  code: 200,
  t: 1518631646,
}
```
- 列表数据
```json
{
  data: {
    list: [],
    page: 1,
    pageSize: 10,
    total: 100,
    more: true
  }
  msg: "",
  code: 200,
  t: 1518631646,
}
```
- 请求错误

```json
{
  data: null, // 特殊情况，批量操作返回成功和失败的元素和原因
  msg: "",
  code: number, // 按正常的错误码返回 
  t: 1518631646,
}
```



## React

### 目录结构

```bash
├── config # umi 配置，包含路由，构建等配置
├── mock # 本地模拟数据
├── public
│ └── favicon.png # Favicon
├── src
│ ├── assets # 本地静态资源
│ ├── components # 业务通用组件
│ ├── e2e # 集成测试用例
│ ├── layouts # 通用布局
│ ├── models # 全局 dva model
│ ├── pages # 业务页面入口和常用模板
│ ├── services # 后台接口服务
│ ├── utils # 工具库
│ ├── locales # 国际化资源
│ ├── global.less # 全局样式
│ └── global.js # 全局 JS
├── tests # 测试工具
├── README.md
└── package.json
```



### 请求流程

UI 组件交互操作；
调用 model 的 effect；
调用统一管理的 service 请求函数；
使用封装的 request.js 发送请求；
获取服务端返回；
然后调用 reducer 改变 state；
更新 model。



### 技术栈学习

以下教程有React详细的开发引导、编程规范，这里不再赘述。目前React的技术栈完全融合阿里巴巴技术生态，有兴趣可前往Ant Design官网学习。

- 实战教程 https://www.yuque.com/ant-design/course
- 企业中后台解决方案 https://pro.ant.design/index-cn
- Umi 可插拔的企业级react 应用框架 [https://umijs.org](https://umijs.org/)

### umi

![umi](https://gw.alipayobjects.com/zos/rmsportal/zvfEXesXdgTzWYZCuHLe.png)
![rmps](https://gw.alipayobjects.com/zos/rmsportal/NKsqmTAttwTzYVMJMcnB.png)



## Vue
### 项目目录结构了解一下
#### 0.1.0版
```bash
.
├── build # 项目构建配置
│   ├── webpack.base.config.js # webpack 基础配置
│   ├── webpack.dev.config.js # 本地开发环境配置
│   ├── webpack.pre.config.js # pre 环境配置
│   ├── webpack.prod.config.js # 测试(test|checkout)环境配置
│   └── webpack.test.config.js # 生产环境配置
├── cli # 命令工具
├── config # 环境变量配置
├── dist # 构建后文件
├── docs # 自动生成文档
├── src
│   ├── api # 请求接口
│   │   ├── api.js # 所有接口汇总输出文件
│   │   ├── commons.js # 通用 api(如获取用户信息，发验证码等与模块无关接口)
│   │   └── toAxios.js # 基于 axios 封装的请求方法
│   ├── assets # 静态资源
│   │   ├── images
│   │   ├── less
│   │   └── svg
│   ├── components # 组件
│   │   ├── commons # 通用组件
│   │   └── layout # 布局组件
│   ├── directive # 指令
│   ├── mock # mock数据
│   ├── router # 路由
│   ├── store # vuex
│   ├── styles # 样式
│   ├── tools # 工具函数集合
│   ├── views # 视图
│   ├── app.js # 入口文件
│   ├── App.vue
│   └── index.html
├── jsconfig.json
├── package.json
├── README.md
└── webpack.config.js
```


### 技术栈简介

- 该项目技术栈为 Vue(V2.5.16)+Vuex，
- 构建工具为 Webpack4.x

### 代码风格

> 绝大部分的内容都可以有`eslint`插件来检查并约束，下面简单列举一些插件可能不会强调的命名相关的规范。

- JavaScript 命名规范：
  - 全局大写英文中间用下划线'\_'连接
  - 普通变量小驼峰
  - class 类或者构造函数大驼峰
- css 类名规范(很少用 id)：
  - 小写英文用中横线'-'连接
  - 如果是 id 小驼峰形式

#### 关于 JavaScript

- JavaScript 语法检查默认使用`eslint`规范
- JavaScript 解释器为 babel，默认引入 babel-polyfill，兼容某些浏览器，若不需要可自行删除
- 最大程度解释最新语法即 stage-0，所有同步操作均为 async-await 方式，Promise 自行封装
- 所有项目用到的工具类方法统一提取放到 `./src/tools` 目录下，可根据功能创建对应文件归类

#### 关于 VUE

- 页面级 vue 文件全部放在 `./src/views`文件下，若有子页面新建页面目录放子页面视图组件
- 组件级 vue 文件分俩种:
  - 第一种全局通用(可能会被多次使用的)命名方式为 `AppFunctionName.vue`(App 功能名.vue)，统一放置在 `./src/components` 目录下
  - 第二种组成页面组件(有且只会被引用一次)命名方式为 `ThePageNameDesc.vue`(The 页面名内容描述.vue)，统一放置在 `./src/components/pageName/` 目录下

#### 关于 VUEX

- Vuex 相关代码全部集中在 `./src/store` 目录
- `./src/store/index.js`为主输出文件，
- 转态管理原则，除了组件内部自己消化的数据外其他的都可以用 vuex 管理。为避免状态管理混乱分模块管理，一个模块包含一个页面及其子页面状态数据:
  - `./src/store/mutation-types.js` 存放所有会用到的类型命名 规则：`PAGE_DATADESC_ACTION` 页面*状态描述*动作(actions 对应 get,mutation 对应 update)
  - `./src/store/mutations.js` 存放全局 mutation 比如通用弹层显示标识状态更新
  - `./src/store/actions.js` 存放全局 actions 比如登录，获取更新用户信息啥的
  - `./src/store/getters.js` 快捷取同时格式化数据方法，貌似有 bug 有时并不实时，很少使用
  - `./src/store/modules` 目录存放各模块的转态管理，子页面状态都集中到父页面 具体写法参考 `./src/store/modules/tpl.js`

#### 关于外部数据请求

- 所有 ajax 数据请求全部封装并集中到 `./src/api` 目录下 （不管是做什么更新数据也好，还是做单一操作也好）
- `./src/api/toAxios.js` 基于 `axios` 封装的请求方法，内部有不同情况的拦截器设计，可根据不同配置执行相应操作
- `./src/api/api.js` 所有接口集中统一输出地方
- `./src/api/page.js` 对应所有页面会用到的接口请求
- `./src/api/sys.js|commons.js` 对用系统级通用级接口 自行安排 唯一的原则就是不能乱，要让别人很快找到某个功能接口写在哪

#### 关于 CSS 样式

- CSS 预处理为 less
- CSS 后处理器为 PostCss
- 默认使用 rem(postcss-px2rem)，即移动端项目，若是 PC 项目可以注释掉引用 rem 插件的处理器
- 通用样式，可以 minixs 样式，可复用样式全部提取放到 `./src/assets/less` 目录下，根据自身功能分别安排
- 组件私有样式放置在 vue 文件内默认使用 scoped 模式

#### 关于图片

- 统一放置到 `./src/images/`目录下
- 多次使用图片 `./src/images/commons`
- 某个页面独有 `./src/images/pageName`

#### 其他项目目录

- `./src/router` vue 路由配置，关于路由跳转 默认原则是先拿到数据在跳转，若获取数据失败会提示，不会跳转 避免有时 vuex 数据在页面更新后才获得数据无法同步的问题
- `./src/socket` 基于 `socket.io` 的 socket 启动处
- `./src/cli` 一个扫描指定目录生成文档的工具
- `./src/doc` 扫描完自动生成的文档内容
- `./src/docs` docsify 文档比较好看

#### 关于 Webpack

- `webpack.base.config.js` 默认基础配置，
- `webpack.dev.config.js` 开发环境配置
- `webpack.test.config.js` 测试环境配置
- `webpack.pro.config.js` 生产环境配置

### 关于 vscode 相关插件

- `vscode-fileheader`
  - 插件fileheader及相关配置

    `"fileheader.Author": "Firmiana",`

    `"fileheader.LastModifiedBy": "Firmiana",`

    `"fileheader.tpl": "/**\r\n * @Author: {author}\r\n * @Date: {createTime}\r\n * @Desc: \r\n */\r\n",`
  - 添加至 `setting.json`

### 注意事项

- ubuntu 下使用 webpack 的热重载无效，是因为 ubuntu 的文件权限问题。

  解决方法：

  1. 提升用户权限（不建议，这样对系统安全不利）

  2. `sudo npm run dev` (在执行之前 sudo 付给权限，测试可用)

- eslint rules 对照地址
  
  `https://cn.eslint.org/docs/rules/`

### 启动或者构建项目

- 在根目录下执行 `yarn install` 为什么不用 `npm i` 或者 `cnpm i` (c)npm 的坑谁用谁知道，本项目用 `cnpm i` 能跑，用 `npm i` 绝对会报错，为避免尴尬请用 `yarn`安装依赖
- 开发环境执行 `npm run dev` 成功后 浏览器打开 `http://127.0.0.1:9981`
- 测试环境执行 `npm run test` 成功后 查看 `./test`目录下文件，-!!!注意!!!-，执行前请先确保测试环境配置以配置正确，
  修改`webpack.test.config.js`里 1) `18`行`publicPath`字段改为测试环境域名路径，`js,css`引用皆依赖这里的绝对路径，2) `34`行 HOST 字段修改为测试环境接口请求的域名

- 测试环境执行 `npm run pro` 成功后 查看 `./dist`目录下文件，-!!!注意!!!-，执行前请先确保生产环境配置以配置正确，
  修改`webpack.test.config.js`里 1) `17`行`publicPath`字段改为测试环境域名路径，`js,css`引用皆依赖这里的绝对路径，2) `33`行`HOST`字段修改为测试环境接口请求的域名



## 阿里生态

- Ant Motion 设计动效
- AntV 数据可视化
- Ant Design Landing 首页模板集
- IconFont 图标库
- kitchen Sketch 工具集
- Umi React 应用开发框架
- Ant Design Mobile